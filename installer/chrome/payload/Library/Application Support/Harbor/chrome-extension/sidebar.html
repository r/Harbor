<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Harbor</title>
    <link rel="stylesheet" href="./design-tokens.css" />
    <style>
      body {
        min-height: 100vh;
        padding: var(--space-3);
      }
      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: var(--space-2);
        padding-bottom: var(--space-2);
        border-bottom: 1px solid var(--color-border-subtle);
      }
      .header-brand {
        display: flex;
        align-items: center;
        gap: var(--space-2);
      }
      .header-logo {
        width: 22px;
        height: 22px;
        background: var(--color-accent-primary);
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--color-text-inverse);
        font-weight: var(--weight-bold);
        font-size: var(--text-xs);
        cursor: pointer;
        transition: transform 0.15s, box-shadow 0.15s;
      }
      .header-logo:hover {
        transform: scale(1.05);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }
      .header-logo:active {
        transform: scale(0.98);
      }
      .header-title {
        font-size: var(--text-sm);
        font-weight: var(--weight-semibold);
        color: var(--color-text-primary);
      }
      .header-status {
        display: flex;
        align-items: center;
        gap: 4px;
        margin-left: var(--space-1);
        padding-left: var(--space-2);
        border-left: 1px solid var(--color-border-subtle);
      }
      .header-status .status-indicator {
        width: 6px;
        height: 6px;
      }
      .header-status .status-text {
        font-size: var(--text-xs);
        font-weight: var(--weight-medium);
      }
      .header-actions {
        display: flex;
        align-items: center;
        gap: var(--space-1);
      }
      .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: var(--radius-full);
        flex-shrink: 0;
      }
      .status-indicator.connected {
        background: var(--color-success);
      }
      .status-indicator.disconnected {
        background: var(--color-error);
      }
      .status-indicator.connecting {
        background: var(--color-warning);
        animation: pulse 1.5s infinite;
      }
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.4; }
      }
      .status-text {
        font-weight: var(--weight-medium);
        font-size: var(--text-sm);
      }
      .status-text.connected { color: var(--color-success); }
      .status-text.disconnected { color: var(--color-error); }
      .status-text.connecting { color: var(--color-warning); }
      .panel {
        background: var(--color-surface-primary);
        border: 1px solid var(--color-border-default);
        border-radius: var(--radius-md);
      }
      .panel + .panel {
        margin-top: var(--space-3);
      }
      .panel-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-2) var(--space-3);
        border-bottom: 1px solid var(--color-border-subtle);
        cursor: pointer;
        user-select: none;
      }
      .panel-header:hover {
        background: var(--color-surface-secondary);
      }
      .panel-title {
        font-size: var(--text-xs);
        font-weight: var(--weight-semibold);
        color: var(--color-text-muted);
        text-transform: uppercase;
        letter-spacing: var(--tracking-wide);
      }
      .panel-toggle {
        font-size: var(--text-xs);
        color: var(--color-text-muted);
        transition: transform 0.2s;
      }
      .panel-toggle.collapsed {
        transform: rotate(-90deg);
      }
      .panel-body {
        padding: var(--space-3);
      }
      .panel-body.collapsed {
        display: none;
      }
      .server {
        padding: var(--space-2);
        border: 1px solid var(--color-border-subtle);
        border-radius: var(--radius-sm);
        background: var(--color-surface-secondary);
      }
      .server + .server {
        margin-top: var(--space-2);
      }
      .server-title {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-weight: var(--weight-semibold);
        gap: var(--space-2);
      }
      .server-meta {
        font-size: var(--text-xs);
        color: var(--color-text-muted);
        margin-top: var(--space-1);
      }
      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: var(--radius-full);
        display: inline-block;
        margin-right: var(--space-1);
      }
      .server-actions {
        display: flex;
        align-items: center;
        gap: var(--space-2);
      }
      .status-running {
        background: var(--color-success);
      }
      .status-stopped {
        background: var(--color-text-muted);
      }
      /* LLM Provider styles */
      .provider {
        padding: var(--space-2);
        border: 1px solid var(--color-border-subtle);
        border-radius: var(--radius-sm);
        background: var(--color-surface-secondary);
      }
      .provider + .provider {
        margin-top: var(--space-2);
      }
      .provider-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--space-2);
      }
      .provider-name {
        font-weight: var(--weight-semibold);
        display: flex;
        align-items: center;
        gap: var(--space-2);
      }
      .provider-badge {
        font-size: var(--text-xs);
        padding: 2px 6px;
        border-radius: var(--radius-sm);
        background: var(--color-surface-tertiary);
        color: var(--color-text-muted);
      }
      .provider-badge.local {
        background: var(--color-success-bg);
        color: var(--color-success);
      }
      .provider-badge.configured {
        background: var(--color-accent-bg);
        color: var(--color-accent-primary);
      }
      .provider-config {
        margin-top: var(--space-2);
        padding-top: var(--space-2);
        border-top: 1px solid var(--color-border-subtle);
        display: none;
      }
      .provider-config.expanded {
        display: block;
      }
      .form-group {
        margin-bottom: var(--space-2);
      }
      .form-group:last-child {
        margin-bottom: 0;
      }
      .form-label {
        display: block;
        font-size: var(--text-xs);
        font-weight: var(--weight-medium);
        color: var(--color-text-muted);
        margin-bottom: var(--space-1);
      }
      .form-input {
        width: 100%;
        padding: var(--space-1) var(--space-2);
        font-size: var(--text-sm);
        border: 1px solid var(--color-border-default);
        border-radius: var(--radius-sm);
        background: var(--color-surface-primary);
        color: var(--color-text-primary);
      }
      .form-input:focus {
        outline: none;
        border-color: var(--color-accent-primary);
      }
      .form-input::placeholder {
        color: var(--color-text-muted);
      }
      .form-hint {
        font-size: var(--text-xs);
        color: var(--color-text-muted);
        margin-top: var(--space-1);
      }
      .form-actions {
        display: flex;
        gap: var(--space-2);
        margin-top: var(--space-2);
      }
      .model-select {
        margin-top: var(--space-3);
        padding-top: var(--space-3);
        border-top: 1px solid var(--color-border-subtle);
      }
      .model-select-label {
        font-size: var(--text-xs);
        font-weight: var(--weight-semibold);
        color: var(--color-text-muted);
        text-transform: uppercase;
        letter-spacing: var(--tracking-wide);
        margin-bottom: var(--space-2);
        display: block;
      }
      .model-dropdown {
        width: 100%;
        padding: var(--space-2);
        font-size: var(--text-sm);
        border: 1px solid var(--color-border-default);
        border-radius: var(--radius-sm);
        background: var(--color-surface-primary);
        color: var(--color-text-primary);
        cursor: pointer;
      }
      .empty-state {
        text-align: center;
        color: var(--color-text-muted);
        padding: var(--space-4);
      }
      /* Panel header with status */
      .panel-header-left {
        display: flex;
        align-items: center;
        gap: var(--space-2);
      }
      .panel-header-right {
        display: flex;
        align-items: center;
        gap: var(--space-1);
      }
      .panel-header-right .status-indicator {
        width: 6px;
        height: 6px;
      }
      .panel-header-right .status-text {
        font-size: var(--text-xs);
      }
      .panel-collapse-icon {
        color: var(--color-text-muted);
        font-size: 10px;
        transition: transform 0.2s;
      }
      .panel-collapse-icon.collapsed {
        transform: rotate(-90deg);
      }
      /* Status summary */
      .status-summary {
        font-size: var(--text-xs);
        color: var(--color-text-muted);
        padding: var(--space-2);
        background: var(--color-surface-secondary);
        border-radius: var(--radius-sm);
        margin-bottom: var(--space-3);
      }
      .status-summary.available {
        background: var(--color-success-bg, rgba(34, 197, 94, 0.1));
        color: var(--color-success);
      }
      .status-summary.unavailable {
        background: var(--color-warning-bg, rgba(234, 179, 8, 0.1));
        color: var(--color-warning, #eab308);
      }
      /* Provider sections */
      .provider-section {
        margin-bottom: var(--space-3);
      }
      .provider-section:last-of-type {
        margin-bottom: 0;
      }
      .section-header {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        margin-bottom: var(--space-1);
      }
      .section-icon {
        font-size: var(--text-sm);
      }
      .section-title {
        font-size: var(--text-xs);
        font-weight: var(--weight-semibold);
        color: var(--color-text-primary);
        text-transform: uppercase;
        letter-spacing: var(--tracking-wide);
      }
      .section-hint {
        font-size: var(--text-xs);
        color: var(--color-text-muted);
        margin-bottom: var(--space-2);
      }
      .badge {
        font-size: 9px;
        padding: 2px 6px;
        border-radius: var(--radius-sm);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: var(--weight-semibold);
      }
      .badge-muted {
        background: var(--color-surface-tertiary);
        color: var(--color-text-muted);
      }
      .badge-success {
        background: var(--color-success-bg, rgba(34, 197, 94, 0.1));
        color: var(--color-success);
      }
      .badge-remote {
        background: rgba(59, 130, 246, 0.15);
        color: #3b82f6;
      }
      /* Provider list */
      .provider-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-2);
      }
      /* Provider item - compact card style */
      .provider-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-2);
        background: var(--color-surface-secondary);
        border: 1px solid var(--color-border-subtle);
        border-radius: var(--radius-sm);
        transition: border-color 0.2s;
      }
      .provider-item:hover {
        border-color: var(--color-border-default);
      }
      .provider-item.available {
        border-left: 3px solid var(--color-success);
      }
      .provider-item.configured {
        border-left: 3px solid var(--color-accent-primary);
      }
      .provider-item.unavailable {
        opacity: 0.7;
      }
      .provider-info {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        flex: 1;
        min-width: 0;
      }
      .provider-name {
        font-size: var(--text-sm);
        font-weight: var(--weight-medium);
        color: var(--color-text-primary);
      }
      .provider-status {
        font-size: var(--text-xs);
        color: var(--color-text-muted);
      }
      .provider-status.available {
        color: var(--color-success);
      }
      .provider-status.configured {
        color: var(--color-accent-primary);
      }
      .provider-actions {
        display: flex;
        align-items: center;
        gap: var(--space-1);
      }
      /* Model select section */
      .model-select-section {
        margin-top: var(--space-3);
        padding-top: var(--space-3);
        border-top: 1px solid var(--color-border-subtle);
      }
      /* Add provider section */
      .add-provider-section {
        margin-bottom: var(--space-3);
      }
      .add-provider-row {
        display: flex;
        gap: var(--space-2);
      }
      .provider-dropdown {
        flex: 1;
        padding: var(--space-2);
        font-size: var(--text-sm);
        border: 1px solid var(--color-border-default);
        border-radius: var(--radius-sm);
        background: var(--color-surface-primary);
        color: var(--color-text-primary);
        cursor: pointer;
      }
      .provider-dropdown:focus {
        outline: none;
        border-color: var(--color-accent-primary);
      }
      /* Provider config form */
      .provider-config-form {
        padding: var(--space-3);
        background: var(--color-surface-secondary);
        border: 1px solid var(--color-border-subtle);
        border-radius: var(--radius-sm);
        margin-bottom: var(--space-3);
      }
      .provider-config-form .form-group {
        margin-bottom: var(--space-2);
      }
      .provider-config-form .form-group:last-of-type {
        margin-bottom: var(--space-3);
      }
      /* Configured providers */
      #configured-providers-section {
        margin-top: var(--space-2);
      }
      #configured-providers-section .section-header {
        margin-bottom: var(--space-2);
      }
      .configured-provider {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-2);
        background: var(--color-surface-secondary);
        border: 1px solid var(--color-border-subtle);
        border-radius: var(--radius-sm);
        margin-bottom: var(--space-2);
      }
      .configured-provider:last-child {
        margin-bottom: 0;
      }
      .configured-provider.available {
        border-left: 3px solid var(--color-success);
      }
      .configured-provider.unavailable {
        border-left: 3px solid var(--color-text-muted);
      }
      .configured-provider.is-default {
        background: var(--color-accent-bg, rgba(99, 102, 241, 0.1));
      }
      .configured-provider-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }
      .configured-provider-name {
        font-size: var(--text-sm);
        font-weight: var(--weight-medium);
        color: var(--color-text-primary);
      }
      .configured-provider-type {
        font-size: var(--text-xs);
        color: var(--color-text-muted);
      }
      .configured-provider-status {
        font-size: var(--text-xs);
      }
      .configured-provider-status.available {
        color: var(--color-success);
      }
      .configured-provider-status.unavailable {
        color: var(--color-text-muted);
      }
      .configured-provider-actions {
        display: flex;
        gap: var(--space-1);
      }
      .no-providers {
        color: var(--color-text-muted);
        font-size: var(--text-sm);
        text-align: center;
        padding: var(--space-3);
      }
      /* Detected Providers List */
      .detected-providers-list {
        margin-bottom: var(--space-3);
      }
      .detected-provider {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-2);
        background: var(--color-surface-secondary);
        border: 1px solid var(--color-border-subtle);
        border-radius: var(--radius-sm);
        margin-bottom: var(--space-2);
      }
      .detected-provider:last-child {
        margin-bottom: 0;
      }
      .detected-provider.available {
        border-left: 3px solid var(--color-success);
      }
      .detected-provider.unavailable {
        border-left: 3px solid var(--color-text-muted);
        opacity: 0.7;
      }
      .detected-provider.needs-config {
        border-left: 3px solid var(--color-warning);
      }
      .detected-provider-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }
      .detected-provider-name {
        font-size: var(--text-sm);
        font-weight: var(--weight-medium);
        color: var(--color-text-primary);
      }
      .detected-provider-status {
        font-size: var(--text-xs);
        display: flex;
        align-items: center;
        gap: var(--space-1);
      }
      .detected-provider-status.available {
        color: var(--color-success);
      }
      .detected-provider-status.unavailable {
        color: var(--color-text-muted);
      }
      .detected-provider-status.needs-config {
        color: var(--color-warning);
      }
      .detected-provider-action {
        flex-shrink: 0;
      }
      /* API Key Config */
      .api-key-config {
        padding: var(--space-3);
        background: var(--color-surface-secondary);
        border: 1px solid var(--color-border-subtle);
        border-radius: var(--radius-sm);
        margin-bottom: var(--space-3);
      }
      .api-key-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: var(--space-2);
        font-weight: var(--weight-medium);
        font-size: var(--text-sm);
      }
      /* Section label */
      .section-label {
        font-size: var(--text-xs);
        font-weight: var(--weight-semibold);
        color: var(--color-text-muted);
        text-transform: uppercase;
        letter-spacing: var(--tracking-wide);
        margin-bottom: var(--space-2);
      }
      /* Configured Models */
      .configured-models-list {
        margin-bottom: var(--space-3);
      }
      .configured-model {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-2);
        background: var(--color-surface-secondary);
        border: 1px solid var(--color-border-subtle);
        border-radius: var(--radius-sm);
        margin-bottom: var(--space-2);
      }
      .configured-model:last-child {
        margin-bottom: 0;
      }
      .configured-model.is-default {
        border-left: 3px solid var(--color-success);
        background: rgba(34, 197, 94, 0.05);
      }
      .configured-model-info {
        flex: 1;
        min-width: 0;
      }
      .configured-model-name {
        font-size: var(--text-sm);
        font-weight: var(--weight-medium);
        color: var(--color-text-primary);
        display: flex;
        align-items: center;
        gap: var(--space-1);
      }
      .configured-model-id {
        font-size: var(--text-xs);
        color: var(--color-text-muted);
        font-family: var(--font-mono);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .configured-model-actions {
        display: flex;
        gap: var(--space-1);
        margin-left: var(--space-2);
      }
      .no-models {
        color: var(--color-text-muted);
        font-size: var(--text-sm);
        text-align: center;
        padding: var(--space-3);
      }
      /* Add Model Section */
      .add-model-section {
        display: flex;
        gap: var(--space-2);
        margin-bottom: var(--space-3);
      }
      .add-model-section .model-dropdown {
        flex: 1;
      }
      /* Providers Details */
      .providers-details {
        margin-top: var(--space-2);
        border-top: 1px solid var(--color-border-subtle);
        padding-top: var(--space-2);
      }
      .providers-summary {
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        font-size: var(--text-xs);
        font-weight: var(--weight-medium);
        color: var(--color-text-muted);
        padding: var(--space-1) 0;
      }
      .providers-summary:hover {
        color: var(--color-text-secondary);
      }
      .providers-count {
        background: var(--color-surface-tertiary);
        padding: 2px 6px;
        border-radius: var(--radius-sm);
        font-size: var(--text-2xs);
      }
      .providers-details[open] .detected-providers-list {
        margin-top: var(--space-2);
      }
      /* Quick Actions Panel */
      .quick-actions-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-2);
      }
      .quick-action-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: var(--space-1);
        padding: var(--space-3);
        background: var(--color-surface-secondary);
        border: 1px solid var(--color-border-subtle);
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: all 0.15s;
      }
      .quick-action-btn:hover {
        background: var(--color-surface-tertiary);
        border-color: var(--color-accent-primary);
      }
      .quick-action-icon {
        font-size: var(--text-lg);
      }
      .quick-action-label {
        font-size: var(--text-xs);
        color: var(--color-text-secondary);
        font-weight: var(--weight-medium);
      }
      
      /* Permissions Panel */
      .permissions-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-2);
      }
      .permission-origin-item {
        background: var(--color-surface-secondary);
        border-radius: var(--radius-sm);
        padding: var(--space-2);
        border: 1px solid var(--color-border-subtle);
      }
      .permission-origin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-1);
      }
      .permission-origin-name {
        font-size: var(--text-xs);
        font-family: var(--font-mono);
        color: var(--color-accent-primary);
        word-break: break-all;
      }
      .permission-source-badge {
        font-size: 9px;
        padding: 2px 6px;
        border-radius: var(--radius-sm);
        background: var(--color-surface-tertiary);
        color: var(--color-text-muted);
        border: 1px solid var(--color-border-subtle);
        text-transform: uppercase;
        letter-spacing: 0.4px;
      }
      .permission-source-badge.web-agents-api {
        color: var(--color-accent-primary);
        border-color: var(--color-accent-primary);
      }
      .permission-scopes {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-top: var(--space-1);
      }
      .permission-scope-badge {
        font-size: 9px;
        padding: 2px 6px;
        border-radius: var(--radius-sm);
        background: rgba(34, 197, 94, 0.15);
        color: var(--color-success);
      }
      .permission-scope-badge.temporary {
        background: rgba(234, 179, 8, 0.15);
        color: var(--color-warning, #eab308);
      }
      .permission-scope-badge.denied {
        background: rgba(239, 68, 68, 0.15);
        color: var(--color-error);
      }
      .permission-temp-label {
        font-size: 8px;
        opacity: 0.85;
        margin-left: 2px;
      }
      .permission-tools-section {
        margin-top: var(--space-2);
        padding-top: var(--space-2);
        border-top: 1px solid var(--color-border-subtle);
      }
      .permission-tools-title {
        font-size: 9px;
        color: var(--color-text-muted);
        text-transform: uppercase;
        margin-bottom: var(--space-1);
      }
      .permission-tools-list {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
      }
      .permission-tool-badge {
        font-size: 9px;
        padding: 2px 6px;
        border-radius: var(--radius-sm);
        background: var(--color-surface-tertiary);
        color: var(--color-text-secondary);
        font-family: var(--font-mono);
        border: 1px solid var(--color-border-subtle);
      }
      .permission-actions {
        display: flex;
        gap: var(--space-1);
        margin-top: var(--space-2);
      }

      /* Session Panel Styles */
      .sessions-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-2);
      }
      .session-item {
        background: var(--color-surface-secondary);
        border-radius: var(--radius-sm);
        padding: var(--space-2);
        border: 1px solid var(--color-border-subtle);
      }
      .session-item.explicit {
        border-left: 3px solid var(--color-accent-primary);
      }
      .session-item.implicit {
        border-left: 3px solid var(--color-text-muted);
      }
      .session-item.terminated {
        opacity: 0.6;
      }
      .session-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--space-1);
      }
      .session-name {
        font-size: var(--text-sm);
        font-weight: var(--weight-medium);
        color: var(--color-text-primary);
        display: flex;
        align-items: center;
        gap: var(--space-1);
      }
      .session-type-badge {
        font-size: 9px;
        padding: 1px 5px;
        border-radius: var(--radius-sm);
        background: var(--color-surface-tertiary);
        color: var(--color-text-muted);
        text-transform: uppercase;
      }
      .session-type-badge.explicit {
        background: rgba(99, 102, 241, 0.15);
        color: var(--color-accent-primary);
      }
      .session-origin {
        font-size: var(--text-xs);
        font-family: var(--font-mono);
        color: var(--color-text-muted);
        word-break: break-all;
        margin-bottom: var(--space-1);
      }
      .session-capabilities {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-bottom: var(--space-2);
      }
      .session-cap-badge {
        font-size: 9px;
        padding: 2px 6px;
        border-radius: var(--radius-sm);
        font-weight: var(--weight-medium);
      }
      .session-cap-badge.llm {
        background: rgba(99, 102, 241, 0.15);
        color: var(--color-accent-primary);
      }
      .session-cap-badge.tools {
        background: rgba(234, 179, 8, 0.15);
        color: var(--color-warning, #eab308);
      }
      .session-cap-badge.browser {
        background: rgba(16, 185, 129, 0.15);
        color: var(--color-success);
      }
      .session-stats {
        display: flex;
        gap: var(--space-3);
        font-size: var(--text-xs);
        color: var(--color-text-muted);
        margin-bottom: var(--space-2);
      }
      .session-stat {
        display: flex;
        align-items: center;
        gap: 4px;
      }
      .session-actions {
        display: flex;
        gap: var(--space-1);
      }
      .session-time {
        font-size: var(--text-xs);
        color: var(--color-text-muted);
      }

      /* Toast notification */
      .toast {
        position: fixed;
        bottom: var(--space-4);
        left: 50%;
        transform: translateX(-50%);
        background: var(--color-text-primary);
        color: var(--color-bg-base);
        padding: var(--space-3) var(--space-4);
        border-radius: var(--radius-md);
        font-size: var(--text-sm);
        font-weight: var(--weight-medium);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        z-index: 1000;
        animation: toast-in 0.2s ease-out;
        max-width: 90%;
        text-align: center;
      }
      .toast.error {
        background: var(--color-error);
        color: white;
      }
      .toast.success {
        background: var(--color-success);
        color: white;
      }
      @keyframes toast-in {
        from {
          opacity: 0;
          transform: translateX(-50%) translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateX(-50%) translateY(0);
        }
      }

    </style>
  </head>
  <body>
    <div class="header">
      <div class="header-brand">
        <div class="header-logo" id="header-logo" title="Open Firefox debugging page">H</div>
        <span class="header-title">Harbor</span>
        <div class="header-status">
          <div id="bridge-status-indicator" class="status-indicator connecting"></div>
          <span id="bridge-status-text" class="status-text connecting">...</span>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn btn-ghost btn-sm" id="reload-extension-btn" title="Reload extension">üîÑ</button>
        <button class="btn btn-ghost btn-sm" id="theme-toggle" title="Toggle theme">üñ•Ô∏è</button>
      </div>
    </div>

    <div class="panel" id="llm-panel">
      <div class="panel-header" id="llm-panel-header">
        <div class="panel-header-left">
          <span class="panel-collapse-icon" id="llm-panel-toggle">&#9660;</span>
          <div class="panel-title">LLM Providers</div>
        </div>
        <div class="panel-header-right">
          <div id="llm-status-indicator" class="status-indicator connecting"></div>
          <span id="llm-status-text" class="status-text connecting">Checking...</span>
        </div>
      </div>
      <div class="panel-body" id="llm-panel-body">
        <!-- Configured Models List -->
        <div class="section-label">Configured Models</div>
        <div id="configured-models" class="configured-models-list"></div>
        
        <!-- Add Model -->
        <div class="add-model-section">
          <select class="model-dropdown" id="available-models">
            <option value="">Select a model to add...</option>
          </select>
          <button class="btn btn-primary btn-sm" id="add-model-btn" disabled>Add</button>
        </div>

        <!-- Detected Providers (collapsible) -->
        <details class="providers-details">
          <summary class="providers-summary">
            <span>Providers</span>
            <span id="providers-count" class="providers-count">0</span>
          </summary>
          <div id="detected-providers" class="detected-providers-list"></div>
          
          <!-- API Key Config -->
          <div id="api-key-config" class="api-key-config" style="display: none;">
            <div class="api-key-header">
              <span id="api-key-provider-name">Configure Provider</span>
              <button class="btn btn-ghost btn-sm" id="api-key-cancel">√ó</button>
            </div>
            <div class="form-group">
              <label class="form-label" for="api-key-input">API Key</label>
              <input type="password" class="form-input" id="api-key-input" placeholder="Enter API key" />
            </div>
            <button class="btn btn-primary btn-sm" id="api-key-save" style="width: 100%;">Save</button>
          </div>
        </details>
      </div>
    </div>

    <!-- OAuth App Credentials Panel -->
    <div class="panel" id="oauth-panel">
      <div class="panel-header" id="oauth-panel-header">
        <div class="panel-header-left">
          <span class="panel-collapse-icon" id="oauth-panel-toggle">&#9660;</span>
          <div class="panel-title">üîë App Credentials</div>
        </div>
        <div class="panel-header-right">
          <div id="oauth-status-indicator" class="status-indicator disconnected"></div>
          <span id="oauth-status-text" class="status-text disconnected">Not configured</span>
        </div>
      </div>
      <div class="panel-body" id="oauth-panel-body">
        <div class="section-hint">OAuth client credentials for MCP servers that need API access (Gmail, GitHub, etc.)</div>
        
        <div id="oauth-providers-list" class="detected-providers-list"></div>
        
        <!-- OAuth Credentials Config Form (hidden by default) -->
        <div id="oauth-config-form" class="api-key-config" style="display: none;">
          <div class="api-key-header">
            <span id="oauth-config-provider-name">Configure Google</span>
            <button class="btn btn-ghost btn-sm" id="oauth-config-cancel">√ó</button>
          </div>
          <div class="form-group">
            <label class="form-label" for="oauth-client-id">Client ID</label>
            <input type="text" class="form-input" id="oauth-client-id" placeholder="your-client-id.apps.googleusercontent.com" />
          </div>
          <div class="form-group">
            <label class="form-label" for="oauth-client-secret">Client Secret</label>
            <input type="password" class="form-input" id="oauth-client-secret" placeholder="Enter client secret" />
          </div>
          <div class="form-hint">Get credentials from <a href="#" id="oauth-help-link" target="_blank">developer console</a></div>
          <button class="btn btn-primary btn-sm" id="oauth-config-save" style="width: 100%; margin-top: var(--space-2);">Save</button>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-header" id="servers-panel-header">
        <div class="panel-header-left">
          <span class="panel-collapse-icon" id="servers-panel-toggle">&#9660;</span>
          <div class="panel-title">MCP Servers</div>
        </div>
        <div class="panel-header-right">
          <button class="btn btn-secondary btn-sm" id="add-remote" title="Add remote MCP server (SSE/WebSocket)">+ Remote</button>
          <button class="btn btn-secondary btn-sm" id="add" title="Load MCP server (.json manifest or .wasm)">+ File</button>
          <input id="file" type="file" accept=".wasm,.json" hidden />
        </div>
      </div>
      <div class="panel-body" id="servers">
        <!-- Remote Server Registration Form (hidden by default) -->
        <div id="remote-server-form" class="api-key-config" style="display: none; margin-bottom: var(--space-3);">
          <div class="api-key-header">
            <span>Add Remote Server</span>
            <button class="btn btn-ghost btn-sm" id="remote-server-cancel">√ó</button>
          </div>
          <div class="form-group">
            <label class="form-label" for="remote-server-url">Server URL</label>
            <input type="text" class="form-input" id="remote-server-url" placeholder="http://localhost:3001/mcp" />
          </div>
          <div class="form-group">
            <label class="form-label" for="remote-server-name">Name</label>
            <input type="text" class="form-input" id="remote-server-name" placeholder="My MCP Server" />
          </div>
          <div class="form-group">
            <label class="form-label" for="remote-server-transport">Transport</label>
            <select class="form-input" id="remote-server-transport">
              <option value="sse">SSE (Server-Sent Events)</option>
              <option value="websocket">WebSocket</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="remote-server-auth">Authorization Header (optional)</label>
            <input type="text" class="form-input" id="remote-server-auth" placeholder="Bearer your-token" />
          </div>
          <div class="form-hint" style="margin-bottom: var(--space-2);">
            Enter the URL of an MCP server that supports SSE or WebSocket transport.
          </div>
          <div class="form-actions">
            <button class="btn btn-secondary btn-sm" id="remote-server-test">Test Connection</button>
            <button class="btn btn-primary btn-sm" id="remote-server-save" style="flex: 1;">Add Server</button>
          </div>
        </div>
        <!-- Server list will be rendered here -->
      </div>
    </div>

    <!-- Tool Tester Panel -->
    <div class="panel" id="tool-tester-panel">
      <div class="panel-header" id="tool-tester-header">
        <div class="panel-header-left">
          <span class="panel-collapse-icon collapsed" id="tool-tester-toggle">&#9660;</span>
          <div class="panel-title">üß™ Tool Tester</div>
        </div>
      </div>
      <div class="panel-body collapsed" id="tool-tester-body">
        <div class="form-group">
          <label class="form-label">Server</label>
          <select class="form-input" id="tool-tester-server">
            <option value="">Select a server...</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Tool</label>
          <select class="form-input" id="tool-tester-tool" disabled>
            <option value="">Select a tool...</option>
          </select>
        </div>
        <div id="tool-tester-schema" style="display: none;">
          <div class="form-group">
            <label class="form-label">Arguments (JSON)</label>
            <textarea class="form-input" id="tool-tester-args" rows="4" placeholder='{"query": "example"}'></textarea>
          </div>
          <div class="form-hint" id="tool-tester-hint" style="margin-bottom: var(--space-2);"></div>
        </div>
        <button class="btn btn-primary btn-sm" id="tool-tester-run" disabled style="width: 100%;">Run Tool</button>
        <div id="tool-tester-result" style="display: none; margin-top: var(--space-3);">
          <div class="form-label">Result</div>
          <pre style="background: var(--color-surface-secondary); padding: var(--space-2); border-radius: var(--radius-sm); font-size: var(--text-xs); overflow-x: auto; max-height: 300px; white-space: pre-wrap; word-break: break-word;"><code id="tool-tester-output"></code></pre>
        </div>
      </div>
    </div>

    <!-- Agent Sessions Panel -->
    <div class="panel" id="sessions-panel">
      <div class="panel-header" id="sessions-panel-header">
        <div class="panel-header-left">
          <span class="panel-collapse-icon" id="sessions-panel-toggle">&#9660;</span>
          <div class="panel-title">ü§ñ Agent Sessions</div>
        </div>
        <div class="panel-header-right">
          <div id="sessions-status-indicator" class="status-indicator disconnected"></div>
          <span id="sessions-count" class="status-text disconnected">0</span>
          <button class="btn btn-ghost btn-sm" id="refresh-sessions-btn" title="Refresh">‚Üª</button>
        </div>
      </div>
      <div class="panel-body" id="sessions-list">
        <div class="empty-state">No active sessions.</div>
      </div>
    </div>

    <!-- Site Permissions Panel -->
    <div class="panel" id="permissions-panel">
      <div class="panel-header" id="permissions-panel-header">
        <div class="panel-header-left">
          <span class="panel-collapse-icon collapsed" id="permissions-panel-toggle">&#9660;</span>
          <div class="panel-title">üîí Site Permissions</div>
        </div>
        <div class="panel-header-right">
          <button class="btn btn-ghost btn-sm" id="refresh-permissions-btn" title="Refresh">‚Üª</button>
        </div>
      </div>
      <div class="panel-body collapsed" id="permissions-list">
        <div class="empty-state">No site permissions granted yet.</div>
      </div>
    </div>

    <!-- Quick Actions Panel -->
    <div class="panel" id="quick-actions-panel">
      <div class="panel-header" id="quick-actions-header">
        <div class="panel-header-left">
          <span class="panel-collapse-icon" id="quick-actions-toggle">&#9660;</span>
          <div class="panel-title">Quick Actions</div>
        </div>
      </div>
      <div class="panel-body" id="quick-actions-body">
        <div class="quick-actions-grid">
          <button class="quick-action-btn" id="open-chat-btn" title="Open chat in new tab">
            <span class="quick-action-icon">üí¨</span>
            <span class="quick-action-label">Open Chat</span>
          </button>
          <button class="quick-action-btn" id="open-directory-btn" title="Browse MCP server directory">
            <span class="quick-action-icon">üìö</span>
            <span class="quick-action-label">Directory</span>
          </button>
        </div>
      </div>
    </div>

    <script type="module" src="./sidebar.js"></script>
  </body>
</html>
