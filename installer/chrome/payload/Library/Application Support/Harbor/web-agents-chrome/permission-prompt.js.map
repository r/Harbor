{
  "version": 3,
  "sources": ["../src/permission-prompt.ts"],
  "sourcesContent": ["/**\n * Permission Prompt Handler\n *\n * Runs in the permission prompt popup window.\n */\n\nimport type { PermissionScope } from './types';\n\n// Scope descriptions for the v1 API\nconst SCOPE_DESCRIPTIONS: Record<PermissionScope, { title: string; description: string; risk: 'low' | 'medium' | 'high' }> = {\n  'model:prompt': {\n    title: 'Text Generation',\n    description: 'Generate text using AI models. The site can send prompts and receive responses.',\n    risk: 'low',\n  },\n  'model:list': {\n    title: 'List Providers',\n    description: 'View available AI providers and models.',\n    risk: 'low',\n  },\n  'mcp:tools.list': {\n    title: 'List Tools',\n    description: 'View available MCP tools that can be called.',\n    risk: 'low',\n  },\n  'mcp:tools.call': {\n    title: 'Execute Tools',\n    description: 'Call MCP tools to perform actions. Tools may access external services.',\n    risk: 'medium',\n  },\n};\n\n// Icons for each scope\nconst SCOPE_ICONS: Record<string, string> = {\n  'model:prompt': '\uD83E\uDD16',\n  'model:list': '\uD83D\uDCCB',\n  'mcp:tools.list': '\uD83D\uDD0C',\n  'mcp:tools.call': '\u26A1',\n};\n\n// =============================================================================\n// Theme Management\n// =============================================================================\n\ntype Theme = 'light' | 'dark' | 'system';\n\nfunction getSystemTheme(): 'light' | 'dark' {\n  return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n}\n\nfunction applyTheme(theme: Theme): void {\n  const effectiveTheme = theme === 'system' ? getSystemTheme() : theme;\n  document.documentElement.setAttribute('data-theme', effectiveTheme);\n}\n\nfunction initTheme(): void {\n  // Use same key as Harbor for theme sync between extensions\n  const saved = localStorage.getItem('harbor-theme') as Theme | null;\n  const theme = saved || 'system';\n  applyTheme(theme);\n\n  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {\n    const current = localStorage.getItem('harbor-theme') as Theme | null;\n    if (current === 'system' || !current) {\n      applyTheme('system');\n    }\n  });\n}\n\n// Initialize theme\ninitTheme();\n\n// =============================================================================\n// Permission Prompt Logic\n// =============================================================================\n\n// Parse URL params\nconst params = new URLSearchParams(window.location.search);\nconst promptId = params.get('promptId') || '';\nconst origin = params.get('origin') || 'Unknown';\nconst scopesParam = params.get('scopes') || '';\nconst reason = params.get('reason') || '';\nconst toolsParam = params.get('tools') || '';\n\nconst scopes = scopesParam.split(',').filter(Boolean) as PermissionScope[];\nconst tools = toolsParam.split(',').filter(Boolean);\n\n// Render origin\nconst originEl = document.getElementById('origin');\nif (originEl) {\n  originEl.textContent = origin;\n}\n\n// Render reason\nif (reason) {\n  const reasonContainer = document.getElementById('reason-container');\n  const reasonEl = document.getElementById('reason');\n  if (reasonContainer && reasonEl) {\n    reasonContainer.style.display = 'block';\n    reasonEl.textContent = reason;\n  }\n}\n\n// Render scopes\nconst scopesList = document.getElementById('scopes-list');\nif (scopesList) {\n  if (scopes.length === 0) {\n    const empty = document.createElement('div');\n    empty.className = 'scopes-empty';\n    empty.textContent = 'No specific permissions requested';\n    scopesList.appendChild(empty);\n  } else {\n    for (const scope of scopes) {\n      const info = SCOPE_DESCRIPTIONS[scope];\n      const icon = SCOPE_ICONS[scope] || '\uD83D\uDD10';\n      \n      const item = document.createElement('div');\n      item.className = 'scope-item';\n      \n      if (info) {\n        item.innerHTML = `\n          <div class=\"scope-header\">\n            <span class=\"scope-icon\">${icon}</span>\n            <span class=\"scope-title\">${info.title}</span>\n            <span class=\"risk-badge risk-${info.risk}\">${info.risk}</span>\n          </div>\n          <div class=\"scope-description\">${info.description}</div>\n        `;\n      } else {\n        item.innerHTML = `\n          <div class=\"scope-header\">\n            <span class=\"scope-icon\">${icon}</span>\n            <span class=\"scope-title\">${scope}</span>\n          </div>\n          <div class=\"scope-description\">Access to ${scope}</div>\n        `;\n      }\n      scopesList.appendChild(item);\n    }\n  }\n}\n\n// Render tools\nif (tools.length > 0) {\n  const toolsSection = document.getElementById('tools-section');\n  const toolsList = document.getElementById('tools-list');\n  if (toolsSection && toolsList) {\n    toolsSection.style.display = 'block';\n\n    for (const tool of tools) {\n      const item = document.createElement('div');\n      item.className = 'tool-item';\n      item.innerHTML = `\n        <input type=\"checkbox\" id=\"tool-${tool}\" data-tool=\"${tool}\" checked>\n        <label for=\"tool-${tool}\" class=\"tool-name\">${tool}</label>\n      `;\n      toolsList.appendChild(item);\n    }\n  }\n}\n\n// Handle deny button\nconst btnDeny = document.getElementById('btn-deny');\nbtnDeny?.addEventListener('click', () => {\n  sendResponse({ granted: false, explicitDeny: true });\n});\n\n// Handle allow button\nconst btnAllow = document.getElementById('btn-grant');\nbtnAllow?.addEventListener('click', () => {\n  const grantOnce = (document.getElementById('grant-once') as HTMLInputElement)?.checked;\n  const grantType = grantOnce ? 'granted-once' : 'granted-always';\n\n  // Collect selected tools\n  const selectedTools: string[] = [];\n  const toolCheckboxes = document.querySelectorAll<HTMLInputElement>('#tools-list input[type=\"checkbox\"]');\n  for (const checkbox of toolCheckboxes) {\n    if (checkbox.checked) {\n      const toolName = checkbox.dataset.tool;\n      if (toolName) selectedTools.push(toolName);\n    }\n  }\n\n  sendResponse({\n    granted: true,\n    grantType,\n    allowedTools: selectedTools.length > 0 ? selectedTools : undefined,\n  });\n});\n\n// Send response to background script\nfunction sendResponse(response: {\n  granted: boolean;\n  grantType?: 'granted-once' | 'granted-always';\n  allowedTools?: string[];\n  explicitDeny?: boolean;\n}): void {\n  console.log('[Permission Prompt] Sending response:', response);\n  chrome.runtime.sendMessage({\n    type: 'permission_prompt_response',\n    response: { promptId, ...response },\n  });\n}\n"],
  "mappings": "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",
  "names": []
}
