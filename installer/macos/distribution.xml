<?xml version="1.0" encoding="utf-8"?>
<installer-gui-script minSpecVersion="2">
    <title>Harbor</title>
    <organization>com.harbor</organization>
    <domains enable_localSystem="true"/>
    
    <!-- Minimum OS version: macOS 12 Monterey -->
    <volume-check>
        <allowed-os-versions>
            <os-version min="12.0"/>
        </allowed-os-versions>
    </volume-check>
    
    <!-- Welcome, License, Conclusion pages -->
    <welcome file="welcome.html" mime-type="text/html"/>
    <license file="license.html" mime-type="text/html"/>
    <conclusion file="conclusion.html" mime-type="text/html"/>
    
    <!-- Installation choices - allows users to select browsers -->
    <choices-outline>
        <line choice="default">
            <line choice="com.harbor.bridge"/>
            <line choice="com.harbor.browsers">
                <line choice="com.harbor.firefox"/>
                <line choice="com.harbor.chrome"/>
            </line>
        </line>
    </choices-outline>
    
    <choice id="default"/>
    
    <!-- Main Harbor Bridge component (always installed) -->
    <choice id="com.harbor.bridge" 
            visible="false" 
            title="Harbor Bridge"
            description="Harbor native bridge for AI agents with MCP tools">
        <pkg-ref id="com.harbor.bridge"/>
    </choice>
    
    <!-- Browser Support (container for Firefox/Chrome choices) -->
    <choice id="com.harbor.browsers"
            title="Browser Support"
            description="Choose which browsers to configure for Harbor">
    </choice>
    
    <!-- Firefox Extension -->
    <choice id="com.harbor.firefox" 
            visible="true"
            selected="true"
            title="Firefox"
            description="Install Harbor extension for Firefox. The sidebar provides access to AI tools and MCP servers.">
    </choice>
    
    <!-- Chrome Extension -->
    <choice id="com.harbor.chrome" 
            visible="true"
            selected="true"
            title="Chrome / Chromium"
            description="Configure native messaging for Chrome. You'll need to manually load the extension from the install location.">
    </choice>
    
    <pkg-ref id="com.harbor.bridge" 
             version="1.0.0" 
             onConclusion="none">harbor-bridge.pkg</pkg-ref>
    
    <!-- JavaScript to pass browser choices to postinstall -->
    <script>
        function installationCheck() {
            return true;
        }
        
        // This runs before postinstall - set env vars for browser choices
        function volumeCheck() {
            return true;
        }
    </script>
    
</installer-gui-script>

